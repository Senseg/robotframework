<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="-1">

<link rel="stylesheet" type="text/css" href="log.css" media="all"/>
<link rel="stylesheet" type="text/css" href="common.css" media="all"/>
<link rel="stylesheet" type="text/css" href="print.css" media="print"/>
<script type="text/javascript" src="log.js"></script>
<script type="text/javascript" src="lib/jquery.min.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.min.js"></script>
<!-- OUTPUT JS --><script type="text/javascript" src="testdata/data.js"></script>
<script type="text/javascript" src="lib/jsxcompressor.js"></script>
<script type="text/javascript" src="model.js"></script>
<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="testdata.js"></script>
<script type="text/javascript" src="view.js"></script>

<title></title>
</head>
<body>
<div id="javascript_disabled" class="error_box">
   <h1>Error when opening log.</h1>
   <!-- TODO: Fine tune text. Check minimum browsers. Also report.html. -->
   <ul>
     <li>Check that JavaScript is enabled in your browser.</li>
     <li>Minimum browser requirements: IE8, Firefox +3.5, Chrome xx, Safari zz, Opera yy.</li>
     <li>Check JavaScript error log if there are errors.</li>
   </ul>
</div>

<div class="header" id="header_div"></div>
<div id="statistics_container"></div>

<script type="text/javascript">
removeJavaScriptDisabledWarning();
$(document).ready(function(){
    var topsuite = window.testdata.suite();
    initLayout(topsuite.name, 'Log');
    addStatistics();
    addErrors();
    addTestExecutionLog(topsuite);
    if (window.location.hash) {
        makeElementVisible(window.location.hash.substring(1));
        window.location.hash = window.location.hash.substring(1);
    } else {
        expandSuite(topsuite);
    }
});

function addErrors() {
    var errors = window.testdata.errors();
    if (errors.length) {
        $.tmpl('errorHeaderTemplate').appendTo($('body'));
        $.tmpl('errorTemplate', errors).appendTo($('#error_table'));
    }
}

function makeElementVisible(element) {
    var uuids = [];
    if (element.indexOf("suite_") == 0) {
        element = element.substring("suite_".length);
        uuids = window.testdata.pathToSuite(unescape(element));
    }
    if (element.indexOf("test_") == 0) {
        element = element.substring("test_".length);
        uuids = window.testdata.pathToTest(unescape(element));
    }
    if (element.indexOf("keyword_") == 0) {
        element = element.substring("keyword_".length);
        uuids = window.testdata.pathToKeyword(unescape(element));
    }
    for (var i in uuids) {
        $("#" + uuids[i] + "_unfoldlink").click();
    }
    if (uuids && uuids.length > 0) {
        expandFailed(window.testdata.find(uuids[uuids.length - 1]));
    }
}

function addTestExecutionLog(main) {
    $('<h2>Test Execution Log</h2>').appendTo($('body'));
    var root = $.tmpl('suiteTemplate', main);
    root.appendTo($('body'));
}
</script>

<script type="text/x-jquery-tmpl" id="totalStatisticsRowTemplate">
  <tr>
    <td class="col_stat_name">
      <div class="stat_name">
        <span title="${doc}">${label}</span>
      </div>
    </td>
    {{tmpl($data) 'stat_columns'}}
  </tr>
</script>

<script type="text/x-jquery-tmpl" id="tagStatisticsRowTemplate">
  <tr>
    <td class="col_stat_name">
      <div class="stat_name">
        <span title="${doc}">${label}</span>
        {{if info}}(${info}){{/if}}
      </div>
      <div class="tag_links">
        {{each links}}
        <span>[<a href="${$value.url}" title="${$value.url}">${$value.title}</a>]</span>
        {{/each}}
      </div>
    </td>
    {{tmpl($data) 'stat_columns'}}
  </tr>
</script>

<script type="text/x-jquery-tmpl" id="suiteStatisticsRowTemplate">
  <tr>
    <td class="col_stat_name">
      <div class="stat_name">
        <a onclick="makeElementVisible('suite_${label}')" href="#suite_${label}" title="${label}"><span class="parent_name">${parentName}</span>${name}</a>
      </div>
    </td>
    {{tmpl($data) 'stat_columns'}}
  </tr>
</script>

<script type="text/x-jquery-tmpl" id="errorHeaderTemplate">
  <h2>Test Execution Errors</h2>
  <table class="errors" id="error_table"></table>
</script>

<script type="text/x-jquery-tmpl" id="errorTemplate">
  <tr>
    <td class="time">
      {{if link}}
      <a onclick="makeElementVisible('${link}')"
         href="#${link}" title="Link to details.">${date}</a>
      {{else}}
      ${date}
      {{/if}}
    </td>
    <td class="${level} level">${levelText}</td>
    <td class="msg">{{html text}}</td>
  </tr>
</script>

<script type="text/x-jquery-tmpl" id="suiteTemplate">
  <table class="suite" id="${id}">
    <tr>
      <td>
        <a class="expand"
           href="javascript:expandAllChildren('${id}')">Expand All</a>
        <div class="foldingbutton" id="${id}_unfoldlink"
             onclick="openSuite('${id}');"
             style="display: block;">+</div>
        <div class="foldingbutton" id="${id}_foldlink"
             onclick="closeElement('${id}');"
             style="display: none;">-</div>
        <span class="${status.toLowerCase()}">TEST&nbsp;SUITE:</span>
        <a class="name" name="suite_${fullName}" title="${name}">${name}</a>
      </td>
    </tr>
    <tr>
      <td class="suite_children">
        <div class="indent" id="${id}_children" style="display: none;">
          <table class="metadata" id="${id}_metadata">
            <tr>
              <th>Full Name:</th>
              <td>${fullName}</td>
            </tr>
            {{if doc()}}
            <tr>
              <th>Documentation:</th>
              <td>{{html doc()}}</td>
            </tr>
            {{/if}}
            {{each metadata}}
            <tr>
              <th>${$value[0]}:</th>
              <td>{{html $value[1]}}</td>
            </tr>
            {{/each}}
            <!-- TODO: Link (href) to source should be relative -->
            {{if source}}
            <tr>
              <th>Source:</th>
              <td><a href="${source}">${source}</a></td>
            </tr>
             {{/if}}
            <tr>
              <th>Start / End / Elapsed:</th><td>${times.startTime}  /  ${times.endTime}  /  ${times.elapsedTime}</td>
            </tr>
            <tr>
              <th>Status:</th>
              <td>{{tmpl($data) 'suiteStatusMessageTemplate'}}</td>
            </tr>
            {{if message()}}
            <tr>
              <th>Message:</th>
              <td>${message()}</td>
            </tr>
            {{/if}}
          </table>
        </div>
      </td>
    </tr>
  </table>
</script>

<script type="text/x-jquery-tmpl" id="testTemplate">
  <table class="test" id="${id}">
    <tr>
      <td>
        <a class="expand"
           href="javascript:expandAllChildren('${id}')">Expand All</a>
        <div class="foldingbutton"
             id="${id}_unfoldlink"
             onclick="openTest('${id}');"
             style="display: block;">+</div>
        <div class="foldingbutton"
             id="${id}_foldlink"
             onclick="closeElement('${id}');"
             style="display: none;">-</div>
        <span class="${status.toLowerCase()}">TEST&nbsp;CASE: </span>
        <a class="name" name="test_${fullName}"
           title="${fullName}">${name}</a>
      </td>
    </tr>
    <tr>
      <td>
        <div class="indent" id="${id}_children" style="display: none;">
          <table class="metadata" id="${id}_metadata">
            <tr>
              <th>Full Name:</th>
              <td>${fullName}</td>
            </tr>
            {{if doc()}}
            <tr>
              <th>Documentation:</th>
              <td>{{html doc()}}</td>
            </tr>
            {{/if}}
            {{if tags.length}}
            <tr>
              <th>Tags:</th>
              <td>${tags.join(', ')}</td>
            </tr>
            {{/if}}
            {{if timeout}}
            <tr>
              <th>Timeout:</th>
              <td>${timeout}</td>
            </tr>
            {{/if}}
            <tr>
              <th>Start / End / Elapsed:</th>
              <td>${times.startTime}  /  ${times.endTime}  /  ${times.elapsedTime}</td>
            </tr>
            <tr>
              <th>Status:</th>
              <td><span class="${status.toLowerCase()}">${status}</span>{{if isCritical}} (critical){{/if}}</td>
            </tr>
            {{if message()}}
            <tr>
              <th>Message:</th>
              <td>${message()}</td>
            </tr>
            {{/if}}
          </table>
        </div>
      </td>
    </tr>
  </table>
</script>

<script type="text/x-jquery-tmpl" id="keywordTemplate">
  <table class="keyword" id="${id}">
    <tr>
      <td>
        <div class="foldingbutton"
             id="${id}_foldlink"
             onclick="closeElement('${id}');"
             style="display: none;">-</div>
        <div class="foldingbutton"
             id="${id}_unfoldlink"
             onclick="openKeyword('${id}');"
             style="display: block;">+</div>
        <span class="${status.toLowerCase()}">${type}: </span>
        <a class="name" name="keyword_${path}" title="${name}">${name}</a>
        <span class="arg">${arguments}</span>
      </td>
    </tr>
    <tr>
      <td>
        <div class="indent" id="${id}_children" style="display: none;">
          <table class="metadata" id="${id}_metadata">
            {{if doc()}}
            <tr>
              <th>Documentation:</th>
              <td>{{html doc()}}</td>
            </tr>
            {{/if}}
            <tr>
              <th>Start / End / Elapsed:</th>
              <td>${times.startTime}  /  ${times.endTime}  /  ${times.elapsedTime}</td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
</script>

<script type="text/x-jquery-tmpl" id="messageTemplate">
  <table class="messages">
    <tr>
      <td class="time">${shortTime()}</td>
      <td class="${level} level">${levelText}</td>
      <td class="msg">{{html text}}</td>
    </tr>
  </table>
</script>

</body>
</html>
